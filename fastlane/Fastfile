$:.unshift File.dirname("../.." + __FILE__)

require '../Various/version.rb'

import './Lyon/Fastfile'
import './Bruxelles/Fastfile'
import './CrÃ©teil/Fastfile'
import './Dublin/Fastfile'
import './Luxembourg/Fastfile'
import './Marseille/Fastfile'
import './Mulhouse/Fastfile'
import './Nantes/Fastfile'
import './Paris/Fastfile'
import './Toulouse/Fastfile'

default_platform :ios

platform :ios do

update_fastlane

before_all do
#   increment_build_number
  # cocoapods
end

lane :appstore do

	# verify_xcode

	ensure_git_branch

	ensure_git_status_clean

	puts "Current build version: #{getCurrentBuildVersion}"

	buildVersion = prompt(text: "Build Version: ")

	updateBuildVersion(buildVersion)

	bumpBuildNumber

	options = {
		:automatic_release => true,
		:skip_screenshots => true
	}

	lyon_appstore(options)

	bruxelles_appstore(options)

	creteil_appstore(options)

	dublin_appstore(options)

	luxembourg_appstore(options)

	marseille_appstore(options)

	mulhouse_appstore(options)

	nantes_appstore(options)

	paris_appstore(options)

	toulouse_appstore(options)

	git_add(path: ".")

	git_commit(path: ".",
	        message: "Version Bump #{buildVersion} (#{getCurrentBuildNumber})")

	add_git_tag(prefix: 'v', build_number: getCurrentBuildNumber)

	push_to_git_remote

end

lane :uploadSymbolsToFabric do

clean_build_artifacts

ENV['DOWNLOAD_DSYMS_BUILD_NUMBER'] = "#{getCurrentBuildNumber}"

lyon_uploadSymbolsToFabric

bruxelles_uploadSymbolsToFabric

creteil_uploadSymbolsToFabric

dublin_uploadSymbolsToFabric

luxembourg_uploadSymbolsToFabric

marseille_uploadSymbolsToFabric

mulhouse_uploadSymbolsToFabric

nantes_uploadSymbolsToFabric

paris_uploadSymbolsToFabric

toulouse_uploadSymbolsToFabric

upload_symbols_to_crashlytics

clean_build_artifacts

end

end
